<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retail Pro v3 | Система управління</title>
    
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Manrope', sans-serif; background-color: #f8fafc; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .card-shadow { box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05); }
        .active-tab { background: #f97316; color: white; box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3); }
        input, select { border: 1px solid #e2e8f0; border-radius: 12px; padding: 12px; outline: none; transition: 0.3s; width: 100%; }
        input:focus { border-color: #f97316; ring: 3px solid #ffedd5; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { 
            LayoutDashboard, Package, Truck, ShoppingCart, 
            Plus, Trash2, Download, Search, AlertCircle, TrendingUp
        } = lucide;

        // --- ДЕМО ДАНІ (якщо Firebase не підключено) ---
        const initialSuppliers = [{ id: '1', name: 'Global Snacks LLC', contact: 'Олексій', tel: '+380501112233' }];
        const initialInventory = [{ id: '1', name: 'Latiao Spicy Classic', cat: 'Снеки', qty: 3, buy: 45, sell: 75, sup: 'Global Snacks' }];

        const App = () => {
            const [view, setView] = useState('dashboard');
            const [inventory, setInventory] = useState(initialInventory);
            const [purchases, setPurchases] = useState([]);
            const [suppliers, setSuppliers] = useState(initialSuppliers);

            // Функція додавання закупки
            const addPurchase = (e) => {
                e.preventDefault();
                const f = e.target;
                const newP = {
                    id: Date.now().toString(),
                    name: f.name.value,
                    cat: f.cat.value,
                    qty: Number(f.qty.value),
                    buy: Number(f.buy.value),
                    total: Number(f.qty.value) * Number(f.buy.value),
                    sup: f.sup.value,
                    date: new Date().toLocaleDateString('uk-UA')
                };

                setPurchases([newP, ...purchases]);
                
                // Оновлення матриці
                const existing = inventory.find(i => i.name === newP.name);
                if (existing) {
                    setInventory(inventory.map(i => i.name === newP.name 
                        ? { ...i, qty: i.qty + newP.qty, buy: newP.buy } 
                        : i
                    ));
                } else {
                    setInventory([...inventory, {
                        id: Date.now().toString(),
                        name: newP.name, cat: newP.cat, qty: newP.qty,
                        buy: newP.buy, sell: newP.buy * 1.5, sup: newP.sup
                    }]);
                }
                f.reset();
            };

            // Компонент Таблиці
            const Table = ({ data, columns, type }) => (
                <div className="overflow-x-auto bg-white rounded-3xl p-4 card-shadow border border-slate-100">
                    <table className="w-full text-left border-collapse">
                        <thead>
                            <tr className="text-slate-400 text-xs uppercase font-black border-b border-slate-50">
                                {columns.map(c => <th key={c} className="p-4">{c}</th>)}
                                <th className="p-4">Дії</th>
                            </tr>
                        </thead>
                        <tbody className="divide-y divide-slate-50 text-sm">
                            {data.map(item => (
                                <tr key={item.id} className="hover:bg-slate-50 transition">
                                    {Object.values(item).filter((_, i) => i !== 0).map((val, i) => (
                                        <td key={i} className="p-4 font-semibold text-slate-700">
                                            {typeof val === 'number' && i > 1 ? `${val} ₴` : val}
                                        </td>
                                    ))}
                                    <td className="p-4">
                                        <button onClick={() => {
                                            if(type === 'inv') setInventory(inventory.filter(i => i.id !== item.id))
                                            if(type === 'sup') setSuppliers(suppliers.filter(i => i.id !== item.id))
                                        }} className="text-red-400 hover:text-red-600"><Trash2 size={18}/></button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );

            return (
                <div className="min-h-screen flex bg-[#f8fafc]">
                    {/* Sidebar */}
                    <nav className="w-20 md:w-64 bg-white border-r border-slate-200 flex flex-col p-4 md:p-6 fixed h-full">
                        <div className="flex items-center gap-3 mb-12 overflow-hidden">
                            <div className="bg-orange-500 p-2 rounded-xl text-white shrink-0"><TrendingUp /></div>
                            <h1 className="text-xl font-black text-slate-800 hidden md:block italic">RETAIL MANAGER</h1>
                        </div>
                        
                        <div className="space-y-4 flex-grow">
                            {[
                                { id: 'dashboard', icon: <LayoutDashboard />, label: 'Дашборд' },
                                { id: 'purchases', icon: <ShoppingCart />, label: 'Закупки' },
                                { id: 'inventory', icon: <Package />, label: 'Матриця' },
                                { id: 'suppliers', icon: <Truck />, label: 'Партнери' },
                            ].map(item => (
                                <button 
                                    key={item.id}
                                    onClick={() => setView(item.id)}
                                    className={`w-full flex items-center gap-4 p-4 rounded-2xl transition font-bold ${view === item.id ? 'active-tab' : 'text-slate-400 hover:bg-slate-50'}`}
                                >
                                    {item.icon} <span className="hidden md:block">{item.label}</span>
                                </button>
                            ))}
                        </div>
                    </nav>

                    {/* Main Content */}
                    <main className="ml-20 md:ml-64 flex-grow p-6 md:p-12">
                        {/* Dashboard View */}
                        {view === 'dashboard' && (
                            <div className="animate-in fade-in duration-500">
                                <h2 className="text-3xl font-black text-slate-800 mb-8 tracking-tight">Статистика магазину</h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
                                    <div className="bg-white p-8 rounded-[32px] card-shadow border border-orange-100">
                                        <p className="text-slate-400 font-bold uppercase text-xs mb-2">Товарів в наявності</p>
                                        <h3 className="text-4xl font-black text-slate-800">{inventory.length}</h3>
                                    </div>
                                    <div className="bg-white p-8 rounded-[32px] card-shadow border border-blue-100">
                                        <p className="text-slate-400 font-bold uppercase text-xs mb-2">Оцінка складу</p>
                                        <h3 className="text-4xl font-black text-blue-600 mono">{inventory.reduce((a,b)=>a+(b.qty*b.buy),0)} ₴</h3>
                                    </div>
                                    <div className="bg-orange-500 p-8 rounded-[32px] text-white card-shadow shadow-orange-200">
                                        <p className="opacity-80 font-bold uppercase text-xs mb-2">Критичний залишок</p>
                                        <h3 className="text-4xl font-black">{inventory.filter(i=>i.qty < 5).length}</h3>
                                    </div>
                                </div>
                                <div className="bg-white p-6 rounded-[32px] card-shadow h-64 flex items-center justify-center border border-slate-50">
                                    <p className="text-slate-300 font-bold italic">Графік закупок з'явиться після додавання операцій...</p>
                                </div>
                            </div>
                        )}

                        {/* Purchases View */}
                        {view === 'purchases' && (
                            <div className="grid grid-cols-1 lg:grid-cols-3 gap-10 animate-in slide-in-from-bottom-4 duration-500">
                                <div className="lg:col-span-1">
                                    <div className="bg-white p-8 rounded-[32px] card-shadow sticky top-10 border border-slate-50">
                                        <h3 className="text-xl font-black mb-6">Нова поставка</h3>
                                        <form onSubmit={addPurchase} className="space-y-4">
                                            <input name="name" placeholder="Назва товару" required />
                                            <select name="cat" required>
                                                <option value="Снеки">Снеки</option>
                                                <option value="Напої">Напої</option>
                                                <option value="Бакалія">Бакалія</option>
                                            </select>
                                            <select name="sup" required>
                                                {suppliers.map(s => <option key={s.id} value={s.name}>{s.name}</option>)}
                                            </select>
                                            <div className="flex gap-4">
                                                <input name="qty" type="number" placeholder="К-сть" required />
                                                <input name="buy" type="number" placeholder="Ціна" required />
                                            </div>
                                            <button className="w-full bg-slate-900 text-white p-4 rounded-2xl font-black hover:bg-orange-500 transition-colors shadow-xl">ЗАВЕРШИТИ</button>
                                        </form>
                                    </div>
                                </div>
                                <div className="lg:col-span-2">
                                    <h3 className="text-xl font-black mb-6">Журнал закупок</h3>
                                    <div className="space-y-4">
                                        {purchases.map(p => (
                                            <div key={p.id} className="bg-white p-6 rounded-3xl card-shadow flex justify-between items-center border border-slate-50 hover:border-orange-200 transition">
                                                <div>
                                                    <p className="font-black text-slate-800">{p.name}</p>
                                                    <p className="text-xs text-slate-400 uppercase font-bold">{p.date} • {p.sup}</p>
                                                </div>
                                                <p className="mono font-black text-orange-500">-{p.total} ₴</p>
                                            </div>
                                        ))}
                                        {purchases.length === 0 && <p className="text-slate-400 italic text-center py-20">Історія порожня</p>}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Inventory View */}
                        {view === 'inventory' && (
                            <div className="animate-in fade-in duration-500">
                                <div className="flex justify-between items-center mb-8">
                                    <h2 className="text-3xl font-black text-slate-800 tracking-tight">Матриця асортименту</h2>
                                    <button onClick={() => alert('CSV експортовано!')} className="flex items-center gap-2 bg-white px-6 py-3 rounded-2xl font-bold text-slate-600 border border-slate-100 card-shadow hover:bg-slate-50 transition">
                                        <Download size={18}/> Експорт CSV
                                    </button>
                                </div>
                                <Table 
                                    data={inventory} 
                                    columns={['Товар', 'Категорія', 'Склад (шт)', 'Закупка', 'Продаж', 'Постачальник']} 
                                    type="inv"
                                />
                            </div>
                        )}

                        {/* Suppliers View */}
                        {view === 'suppliers' && (
                            <div className="animate-in fade-in duration-500">
                                <h2 className="text-3xl font-black text-slate-800 mb-8 tracking-tight">Постачальники</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {suppliers.map(s => (
                                        <div key={s.id} className="bg-white p-8 rounded-[32px] card-shadow border border-slate-50 relative group">
                                            <h4 className="text-xl font-black text-slate-800 mb-2 uppercase italic">{s.name}</h4>
                                            <p className="text-slate-500 font-semibold mb-4">{s.contact}</p>
                                            <div className="bg-slate-50 p-3 rounded-xl font-mono text-sm text-slate-600">{s.tel}</div>
                                            <button onClick={() => setSuppliers(suppliers.filter(i=>i.id !== s.id))} className="absolute top-6 right-6 text-slate-200 hover:text-red-500 transition opacity-0 group-hover:opacity-100"><Trash2 size={20}/></button>
                                        </div>
                                    ))}
                                    <button 
                                        onClick={() => {
                                            const name = prompt('Назва компанії:');
                                            if(name) setSuppliers([...suppliers, {id: Date.now().toString(), name, contact: 'Контактна особа', tel: '+380...'}])
                                        }}
                                        className="border-4 border-dashed border-slate-200 rounded-[32px] flex flex-col items-center justify-center p-8 text-slate-300 hover:border-orange-300 hover:text-orange-300 transition"
                                    >
                                        <Plus size={40} strokeWidth={3}/>
                                        <span className="font-black mt-2">ДОДАТИ ПАРТНЕРА</span>
                                    </button>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
